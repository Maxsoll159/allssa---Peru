"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[254],{7974:function(e,r,s){s.d(r,{w:function(){return l}});var i=s(6869),n=s(7796);let[,l]=(0,i.K_)(e=>({queryKey:["user"],queryFn:()=>n.o.get("/api/user").then(e=>e.data).catch(async()=>{await n.o.post("/api/auth/signout"),window.location.pathname="/auth/signin"})}))},3345:function(e,r,s){s.d(r,{C:function(){return l},I:function(){return o}});var i=s(7974),n=s(3665);let l=(0,n.cn)(e=>{var r;return null===(r=e(i.w).data)||void 0===r?void 0:r.user}),o=(0,n.cn)(e=>{var r,s;return null===(r=e(i.w).data)||void 0===r?void 0:null===(s=r.user)||void 0===s?void 0:s.isAdmin})},8976:function(e,r,s){s.d(r,{o:function(){return l}});var i=s(6154),n=s(3454);let l=i.Z.create({baseURL:n.env.NEXT_PUBLIC_BACKEND_URL})},5849:function(e,r,s){s.d(r,{t:function(){return t},Z:function(){return l}});var i=s(5893),n=s(639);let l=e=>(0,i.jsxs)(n.gC,{w:"full",h:"full",children:[(0,i.jsxs)(n.Ug,{justifyContent:"space-between",w:"full",children:[(0,i.jsxs)(n.gC,{alignItems:"flex-start",children:[(0,i.jsx)(n.X6,{as:"h2",size:"md",color:"text.dark",children:e.title}),e.subTitle&&(0,i.jsx)(n.xv,{color:"gray.500",children:e.subTitle})]}),(0,i.jsx)(n.xu,{children:e.rightRenderHeader})]}),(0,i.jsx)(n.xu,{mt:"1rem",flex:"1",h:"0",w:"full",children:e.children})]});var o=s(7741),a=s(7294);let t=e=>{let{currentPage:r,totalPages:s,onChange:l}=e,[t,c]=(0,a.useState)(s);(0,a.useEffect)(()=>{0!==s&&c(s)},[s,c]);let d=[];for(let u=0;u<Math.min(7,t);u++)if(r<=4)d[u]=u;else{let h=Math.max(r+4-1,t)-t;d[u]=u+r-4-h}return(0,i.jsxs)(n.Ug,{w:"full",h:"full",justifyContent:"flex-end",children:[(0,i.jsx)(o.zx,{size:"sm",colorScheme:"gray",disabled:0===r,onClick:()=>l(r-1),children:"<"}),d.map((e,s)=>(0,i.jsx)(o.zx,{colorScheme:e===r?"primary":"gray",size:"sm",onClick:()=>l(e),children:e+1},"button-"+s)),(0,i.jsx)(o.zx,{size:"sm",colorScheme:"gray",disabled:r===t-1,onClick:()=>l(r+1),children:">"})]})}},7796:function(e,r,s){s.d(r,{o:function(){return i.o}});var i=s(8976)},3009:function(e,r,s){s.d(r,{Z:function(){return f}});var i=s(5893),n=s(639),l=s(7741),o=s(3665),a=s(3345),t=s(1163),c=s(2920),d=s(8976),u=s(5675),h=s.n(u),x=s(9008),j=s.n(x);let m=e=>({position:"relative",h:"full",justifyContent:"center",px:"1rem",color:"text.dark",cursor:"pointer",userSelect:"none",_hover:{_before:{transform:"translateY(0px)"}},_before:{content:"' '",position:"absolute",transform:"translateY(".concat(e?"0":"-4px",")"),transition:"transform 400ms",top:0,left:0,borderRadius:"8",w:"full",h:"4px",bg:"primary.500"}}),f=e=>{let r=(0,o.Dv)(a.I),s=(0,t.useRouter)(),u=async()=>{try{await d.o.post("/api/auth/signout"),window.location.pathname="/auth/signin"}catch(e){throw c.Am.error("Error al cerrar sesi\xf3n"),e}};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(j(),{children:(0,i.jsxs)("title",{children:["Dataverifica - ",r?"Administrador":"Cliente"]})}),(0,i.jsxs)(n.Kq,{w:"100vw",h:"100vh",bg:"primary.200",position:"relative",spacing:"0",children:[(0,i.jsxs)(n.Ug,{w:"full",h:"3.5rem",bg:"white",px:"6",spacing:"12",children:[(0,i.jsx)(n.xu,{children:(0,i.jsx)(h(),{src:"/logo.jpg",alt:"logo",height:64,width:64})}),(0,i.jsx)(n.Ug,{flex:"1",h:"full",children:r&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.Kq,{sx:m("/"===s.pathname),onClick(){s.push("/")},children:(0,i.jsx)(n.xv,{children:"Peticiones"})}),(0,i.jsx)(n.Kq,{sx:m("/users"===s.pathname),onClick(){s.push("/users")},children:(0,i.jsx)(n.xv,{children:"Usuarios"})}),(0,i.jsx)(n.Kq,{sx:m("/admins"===s.pathname),onClick(){s.push("/admins")},children:(0,i.jsx)(n.xv,{children:"Administradores"})})]})}),(0,i.jsx)(n.xu,{children:(0,i.jsx)(l.zx,{colorScheme:"red",size:"sm",rounded:"full",onClick:u,children:"Cerrar sesi\xf3n"})})]}),(0,i.jsx)(n.iz,{}),(0,i.jsx)(n.xu,{flex:"1",height:"0",px:"6",py:"4",children:(0,i.jsx)(n.xu,{alignItems:"start-flex",bg:"white",borderRadius:"12",p:"6",shadow:"lg",w:"full",h:"full",overflow:"hidden",children:e.children})})]})]})}},8003:function(e,r,s){s.d(r,{h:function(){return _}});var i=s(5893),n=s(7294),l=s(7741),o=s(639),a=s(5849),t=s(5675),c=s.n(t),d=s(2161),u=s(3665),h=s(6869),x=s(7796);let j=e=>x.o.get("/api/users?page="+e).then(e=>e.data),m=e=>x.o.get("/api/admins?page="+e).then(e=>e.data),f=e=>x.o.put("/api/users",e),p=e=>x.o.post("/api/users",e),g=e=>x.o.delete("/api/users?id="+e),w=["users"],v=["admins"],C=(0,u.cn)(0),y=(0,u.cn)(0),[,I]=(0,h.N0)(e=>({queryKey:[...w,e(C)],queryFn(e){let{queryKey:[,r]}=e;return d.sk?void 0:j(r)}})),[,b]=(0,h.N0)(e=>({queryKey:[...v,e(y)],queryFn(e){let{queryKey:[,r]}=e;return d.sk?void 0:m(r)}}));var z=s(6696);let k=e=>{let{users:r=[],isLoading:s,onClickEdit:n,onDelete:o}=e;return(0,i.jsx)(z.xJ,{h:"full",overflowY:"auto",w:"full",children:(0,i.jsxs)(z.iA,{variant:"simple",children:[(0,i.jsx)(z.Rn,{hidden:s||r.length>0,children:"A\xfan no hay usuarios"}),(0,i.jsx)(z.Rn,{hidden:!s,children:"Cargando..."}),(0,i.jsxs)(z.hr,{position:"sticky",top:"0",bg:"white",zIndex:"1",children:[(0,i.jsx)(z.Th,{pl:"0",color:"gray.500",children:"Usuario"}),(0,i.jsx)(z.Th,{color:"gray.500",children:"Nombre"}),(0,i.jsx)(z.Th,{color:"gray.500",children:"RUC / DNI"}),(0,i.jsx)(z.Th,{color:"gray.500",children:"Tel\xe9fono"}),(0,i.jsx)(z.Th,{color:"gray.500",children:"Correo"}),(0,i.jsx)(z.Th,{color:"gray.500",children:"Actualizar"})]}),(0,i.jsx)(z.p3,{children:r.map((e,r)=>{var s,a,t,c;return(0,i.jsxs)(z.Tr,{fontSize:"sm",color:"text.dark",children:[(0,i.jsx)(z.Td,{pl:"0",fontWeight:"bold",children:null!==(s=e.username)&&void 0!==s?s:"--"}),(0,i.jsx)(z.Td,{fontWeight:"bold",children:e.companyName}),(0,i.jsx)(z.Td,{children:null!==(a=e.ruc)&&void 0!==a?a:"--"}),(0,i.jsx)(z.Td,{children:null!==(t=e.phone)&&void 0!==t?t:"--"}),(0,i.jsx)(z.Td,{children:null!==(c=e.email)&&void 0!==c?c:"--"}),(0,i.jsxs)(z.Td,{w:"0",children:[(0,i.jsx)(l.zx,{size:"sm",colorScheme:"gray",onClick:()=>null==n?void 0:n(r),children:"Editar"}),(0,i.jsx)(l.zx,{ml:"4",size:"sm",colorScheme:"red",onClick:()=>null==o?void 0:o(r),children:"Eliminar"})]})]},"userItem-".concat(r))})})]})})};var A=s(5945),N=s(7536),S=s(2920),U=s(7869),T=s(3234),E=s(979),O=s(5113);let q=e=>{let{register:r,handleSubmit:s,reset:a}=(0,N.cI)({mode:"onBlur"}),t=(0,A.NL)(),[c,d]=(0,n.useState)(!1),u=async r=>{d(!0),r.isAdmin=e.isAdmin,r.password=await (0,O.JQ)(r.password);try{await f(r),await t.invalidateQueries(e.isAdmin?v:w),e.onClose(),S.Am.success("\xa1Usuario creado!"),a()}catch(s){throw S.Am.error("Hubo un error al crear al usuario"),s}finally{d(!1)}},h=()=>{c||(a(),e.onClose())};return(0,i.jsxs)(U.u_,{onClose:h,isOpen:!!e.isOpen,isCentered:!0,closeOnOverlayClick:!1,closeOnEsc:!1,children:[(0,i.jsx)(U.ZA,{}),(0,i.jsx)("form",{onSubmit:s(u),autoComplete:"off",children:(0,i.jsxs)(U.hz,{minW:"40rem",children:[(0,i.jsx)(U.xB,{color:"text.dark",children:"Agregar usuario"}),(0,i.jsx)(U.ol,{}),(0,i.jsx)(U.fe,{children:(0,i.jsxs)(o.gC,{w:"full",spacing:"6",children:[(0,i.jsxs)(o.Ug,{w:"full",spacing:"6",children:[(0,i.jsxs)(T.NI,{children:[(0,i.jsx)(T.lX,{children:"Usuario"}),(0,i.jsx)(E.II,{...r("username"),required:!0})]}),(0,i.jsxs)(T.NI,{children:[(0,i.jsx)(T.lX,{children:"Contrase\xf1a"}),(0,i.jsx)(E.II,{...r("password"),required:!0,type:"password"})]})]}),(0,i.jsxs)(o.Ug,{w:"full",spacing:"6",children:[(0,i.jsxs)(T.NI,{children:[(0,i.jsx)(T.lX,{children:"Nombre"}),(0,i.jsx)(E.II,{...r("companyName")})]}),(0,i.jsxs)(T.NI,{children:[(0,i.jsx)(T.lX,{children:"RUC / DNI"}),(0,i.jsx)(E.II,{...r("ruc")})]})]}),(0,i.jsxs)(o.Ug,{w:"full",spacing:"6",children:[(0,i.jsxs)(T.NI,{children:[(0,i.jsx)(T.lX,{children:"Tel\xe9fono"}),(0,i.jsx)(E.II,{...r("phone")})]}),(0,i.jsxs)(T.NI,{children:[(0,i.jsx)(T.lX,{children:"Correo"}),(0,i.jsx)(E.II,{...r("email")})]})]})]})}),(0,i.jsxs)(U.mz,{children:[(0,i.jsx)(l.zx,{mr:"1rem",colorScheme:"gray",onClick:h,disabled:c,children:"Cancelar"}),(0,i.jsx)(l.zx,{isLoading:c,type:"submit",children:"Crear"})]})]})})]})},L=e=>{let{register:r,handleSubmit:s,setValue:a}=(0,N.cI)({mode:"onBlur"});(0,n.useEffect)(()=>{if(e.user){let r=e.user;Object.keys(r).forEach(e=>{a(e,null==r?void 0:r[e])})}},[e.user]);let t=(0,A.NL)(),[c,d]=(0,n.useState)(!1),u=async r=>{var s;d(!0),r.id=null===(s=e.user)||void 0===s?void 0:s.id,r.password||(r.password=void 0),r.password&&(r.password=await (0,O.JQ)(r.password));try{await p(r),await t.invalidateQueries(e.isAdmin?v:w),d(!1),e.onClose(),S.Am.success("\xa1Usuario actualizado!")}catch(i){throw S.Am.error("Hubo un error al actualizar al usuario"),i}},h=()=>{c||e.onClose()};return(0,i.jsxs)(U.u_,{onClose:h,isOpen:!!e.isOpen,isCentered:!0,closeOnOverlayClick:!1,closeOnEsc:!1,children:[(0,i.jsx)(U.ZA,{}),(0,i.jsx)("form",{onSubmit:s(u),autoComplete:"off",children:(0,i.jsxs)(U.hz,{minW:"40rem",children:[(0,i.jsx)(U.xB,{color:"text.dark",children:"Actualizar usuario"}),(0,i.jsx)(U.ol,{}),(0,i.jsx)(U.fe,{children:(0,i.jsxs)(o.gC,{w:"full",spacing:"6",children:[(0,i.jsxs)(o.Ug,{w:"full",spacing:"6",children:[(0,i.jsxs)(T.NI,{children:[(0,i.jsx)(T.lX,{children:"Usuario"}),(0,i.jsx)(E.II,{...r("username"),required:!0})]}),(0,i.jsxs)(T.NI,{children:[(0,i.jsx)(T.lX,{children:"Contrase\xf1a"}),(0,i.jsx)(E.II,{...r("password"),type:"password"})]})]}),(0,i.jsxs)(o.Ug,{w:"full",spacing:"6",children:[(0,i.jsxs)(T.NI,{children:[(0,i.jsx)(T.lX,{children:"Nombre"}),(0,i.jsx)(E.II,{...r("companyName")})]}),(0,i.jsxs)(T.NI,{children:[(0,i.jsx)(T.lX,{children:"RUC / DNI"}),(0,i.jsx)(E.II,{...r("ruc")})]})]}),(0,i.jsxs)(o.Ug,{w:"full",spacing:"6",children:[(0,i.jsxs)(T.NI,{children:[(0,i.jsx)(T.lX,{children:"Tel\xe9fono"}),(0,i.jsx)(E.II,{...r("phone")})]}),(0,i.jsxs)(T.NI,{children:[(0,i.jsx)(T.lX,{children:"Correo"}),(0,i.jsx)(E.II,{...r("email")})]})]})]})}),(0,i.jsxs)(U.mz,{children:[(0,i.jsx)(l.zx,{mr:"1rem",colorScheme:"gray",onClick:h,disabled:c,children:"Cancelar"}),(0,i.jsx)(l.zx,{isLoading:c,type:"submit",children:"Actualizar"})]})]})})]})},X=e=>(0,i.jsxs)(U.u_,{onClose:e.onClose,isOpen:!!e.isOpen,isCentered:!0,children:[(0,i.jsx)(U.ZA,{}),(0,i.jsxs)(U.hz,{minW:"40rem",maxH:"calc(100vh - 2rem)",m:"0",children:[(0,i.jsx)(U.xB,{color:"text.dark",children:"Eliminar Usuario"}),(0,i.jsx)(U.ol,{top:"0.9rem"}),(0,i.jsx)(U.fe,{maxH:"100%",overflow:"auto",children:(0,i.jsx)(o.X6,{as:"h2",size:"sm",color:"text.dark",children:"\xbfEst\xe1s seguro de que deseas eliminar este usuario?"})}),(0,i.jsxs)(U.mz,{children:[(0,i.jsx)(l.zx,{mr:"1rem",colorScheme:"gray",onClick:()=>e.onClose(),children:"Cancelar"}),(0,i.jsx)(l.zx,{colorScheme:"red",onClick:()=>e.onDelete(),isLoading:e.isLoading,children:"Eliminar"})]})]})]}),_=e=>{var r,s;let{isAdmin:t}=e,d=(0,A.NL)(),[h,x]=(0,u.KO)(t?y:C),{data:j,isLoading:m,isFetching:f,refetch:p}=(0,u.Dv)(t?b:I),z=null===(r=null==j?void 0:j.pages[0])||void 0===r?void 0:r.data,N=null===(s=null==j?void 0:j.pages[0])||void 0===s?void 0:s.pages,[U,T]=(0,n.useState)(!1),[E,O]=(0,n.useState)(!1),[_,K]=(0,n.useState)(!1),[R,D]=(0,n.useState)(!1),[H,B]=(0,n.useState)(0),Z=async()=>{if(z){D(!0);try{await g(z[H].id),await d.invalidateQueries(t?v:w),K(!1),S.Am.success("\xa1Usuario eliminado!")}catch(e){throw S.Am.error("Hubo un error al eliminar al usuario"),e}finally{D(!1)}}};return(0,i.jsxs)(a.Z,{title:t?"Administradores":"Usuarios (Clientes)",subTitle:t?"Lista de todos los administradores":"Lista de todos los usuarios",rightRenderHeader:(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(l.hU,{colorScheme:"gray","aria-label":"refresh",isLoading:f,onClick:()=>p(),children:(0,i.jsx)(c(),{alt:"refresh svg",src:"/refresh.svg",width:16,height:16})}),(0,i.jsx)(l.zx,{ml:"4",onClick:()=>T(!0),children:"+ Agregar nuevo"})]}),children:[(0,i.jsxs)(o.gC,{mt:"1rem",h:"full",w:"full",spacing:"0",children:[(0,i.jsx)(o.xu,{flex:"1",h:"0",w:"full",children:(0,i.jsx)(k,{isLoading:m,users:z,onClickEdit(e){B(e),O(!0)},onDelete(e){B(e),K(!0)}})}),(0,i.jsx)(o.iz,{}),(0,i.jsx)(o.xu,{w:"full",h:"4rem",children:(0,i.jsx)(a.t,{currentPage:h,totalPages:null!=N?N:0,onChange:x})})]}),(0,i.jsx)(q,{isAdmin:t,isOpen:U,onClose:()=>T(!1)}),(0,i.jsx)(L,{isAdmin:t,user:null==z?void 0:z[H],isOpen:E,onClose:()=>O(!1)}),(0,i.jsx)(X,{isOpen:_,onClose:()=>K(!1),isLoading:R,onDelete:Z})]})}},5113:function(e,r,s){s.d(r,{JQ:function(){return l}});let i=e=>{let r=new DataView(e),s="";for(let i=0;i<r.byteLength;i+=4)s+=r.getUint32(i).toString(16).padStart(8,"0");return s},n=e=>async(r,{outputFormat:s="hex"}={})=>{"string"==typeof r&&(r=new globalThis.TextEncoder().encode(r));let n=await globalThis.crypto.subtle.digest(e,r);return"hex"===s?i(n):n};n("SHA-1");let l=n("SHA-256");n("SHA-384"),n("SHA-512")}}]);